(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{85:function(s,n,a){"use strict";a.r(n);var t=a(0),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"运行和控制nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行和控制nginx"}},[s._v("#")]),s._v(" 运行和控制Nginx")]),s._v(" "),a("h2",{attrs:{id:"nginx命令行参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx命令行参数"}},[s._v("#")]),s._v(" nginx命令行参数")]),s._v(" "),a("p",[s._v("不像许多其他软件系统，Nginx 仅有几个命令行参数，完全通过配置文件来配置")]),s._v(" "),a("p",[a("code",[s._v("-c </path/to/config>")]),s._v(" 为 Nginx 指定一个配置文件，来代替缺省的。")]),s._v(" "),a("p",[a("code",[s._v("-t")]),s._v(" 不运行，而仅仅测试配置文件。nginx 将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。")]),s._v(" "),a("p",[a("code",[s._v("-v")]),s._v(" 显示 nginx 的版本。")]),s._v(" "),a("p",[a("code",[s._v("-V")]),s._v(" 显示 nginx 的版本，编译器版本和配置参数。")]),s._v(" "),a("h2",{attrs:{id:"nginx控制信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx控制信号"}},[s._v("#")]),s._v(" nginx控制信号")]),s._v(" "),a("p",[s._v("可以使用信号系统来控制主进程。默认，nginx 将其主进程的 pid 写入到 /usr/local/nginx/nginx.pid 文件中。通过传递参数给 ./configure 或使用 pid 指令，来改变该文件的位置。")]),s._v(" "),a("p",[s._v("主进程可以处理以下的信号：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("信号")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("TERM, INT")]),s._v(" "),a("td",[s._v("快速关闭")])]),s._v(" "),a("tr",[a("td",[s._v("QUIT")]),s._v(" "),a("td",[s._v("从容关闭")])]),s._v(" "),a("tr",[a("td",[s._v("HUP")]),s._v(" "),a("td",[s._v("重载配置，用新的配置开始新的工作进程，从容关闭旧的工作进程")])]),s._v(" "),a("tr",[a("td",[s._v("USR1")]),s._v(" "),a("td",[s._v("重新打开日志文件")])]),s._v(" "),a("tr",[a("td",[s._v("USR2")]),s._v(" "),a("td",[s._v("平滑升级可执行程序。")])]),s._v(" "),a("tr",[a("td",[s._v("WINCH")]),s._v(" "),a("td",[s._v("从容关闭工作进程")])])])]),s._v(" "),a("p",[s._v("尽管你不必自己操作工作进程，但是，它们也支持一些信号：")]),s._v(" "),a("p",[s._v("TERM, INT\t快速关闭\nQUIT\t从容关闭\nUSR1\t重新打开日志文件")]),s._v(" "),a("p",[s._v("Linux/Unix中向一个进程发送信号用kill命令，不要以为kill命令只是用来杀死进程的，它可以发送各种信号给进程，杀死进程只是用到了其中的一个SIGKILL信号，kill命令的格式其实是这样的：")]),s._v(" "),a("p",[s._v("kill 信号参数 进程PID")]),s._v(" "),a("p",[s._v("其中常见的信号参数（英文横杠加阿拉伯数字）有如下几个，更多的信号信息参考可以用man命令查看手册页（man 7 signal）：")]),s._v(" "),a("p",[s._v("-1：这个参数代表SIGHUP信号，作用类似重新启动进程；")]),s._v(" "),a("p",[s._v("-2：这个参数代表SIGINT信号，作用相当于在命令行输入Ctrl+C组合键中断进程的运行；")]),s._v(" "),a("p",[s._v("-9：这个参数代表SIGKILL信号，代表强制中断进程；")]),s._v(" "),a("p",[s._v("-15：这个参数代表SIGTERM信号，表示正常的终止进程；")]),s._v(" "),a("p",[s._v("-17：这个参数代表SIGSTOP信号，相当于在终端输入Ctrl+Z组合键来暂停进程的运行。")]),s._v(" "),a("h2",{attrs:{id:"nginx-启动、停止、重启命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-启动、停止、重启命令"}},[s._v("#")]),s._v(" nginx 启动、停止、重启命令")]),s._v(" "),a("h3",{attrs:{id:"nginx启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx启动"}},[s._v("#")]),s._v(" nginx启动")]),s._v(" "),a("p",[s._v("sudo /usr/local/nginx/nginx     (nginx二进制文件绝对路径，需要根据自己安装路径实际决定)")]),s._v(" "),a("h3",{attrs:{id:"nginx从容停止命令，等所有请求结束后关闭服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx从容停止命令，等所有请求结束后关闭服务"}},[s._v("#")]),s._v(" nginx从容停止命令，等所有请求结束后关闭服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -QUIT  nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主进程号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"nginx-快速停止命令，立刻关闭nginx进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-快速停止命令，立刻关闭nginx进程"}},[s._v("#")]),s._v(" nginx 快速停止命令，立刻关闭nginx进程")]),s._v(" "),a("p",[s._v("ps -ef |grep nginx")]),s._v(" "),a("p",[s._v("kill -TERM nginx主进程号")]),s._v(" "),a("h3",{attrs:{id:"强制停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强制停止"}},[s._v("#")]),s._v(" 强制停止")]),s._v(" "),a("p",[s._v("kill -9 nginx主进程号")]),s._v(" "),a("p",[s._v("如果嫌麻烦可以不用查看进程号，直接使用命令进行操作，其中"),a("code",[s._v("/usr/local/nginx/nginx.pid")]),s._v("为nginx.conf中pid命令设置的参数，用来存放nginx主进程号的文件")]),s._v(" "),a("p",[s._v("kill -信号类型(HUP|TERM|QUIT)")]),s._v(" "),a("p",[s._v("cat /usr/local/nginx/nginx.pid\n例如")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -QUIT "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/local/nginx/nginx.pid"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"nginx重启命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx重启命令"}},[s._v("#")]),s._v(" nginx重启命令")]),s._v(" "),a("ol",[a("li",[s._v("简单型，先关闭进程，修改你的配置后，重启进程。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -QUIT "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/local/nginx/nginx.pid\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/local/nginx/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("重新加载配置文件，不重启进程，不会停止处理请求")]),s._v(" "),a("li",[s._v("平滑更新nginx二进制，不会停止处理请求")])]),s._v(" "),a("h2",{attrs:{id:"使用信号加载新的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用信号加载新的配置"}},[s._v("#")]),s._v(" 使用信号加载新的配置")]),s._v(" "),a("p",[s._v("Nginx 支持几个信号，能在它运行时控制其操作。其中最普通的是 15 ，用来中止运行的进程：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(PID|nginx)'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n    root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2213")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6784")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2036")]),s._v(" ?        Ss   03:01   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -15 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2213")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("而最有趣的是能平滑改变 nginx 配置的选项（请注意，在重载前，要先测试一下配置文件）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("nginx -t -c /etc/nginx/nginx.conf\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2006")]),s._v("/09/16 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":07:10 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15686")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0: the configuration file /etc/nginx/nginx.conf syntax is ok")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2006")]),s._v("/09/16 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":07:10 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15686")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0: the configuration file /etc/nginx/nginx.conf was tested successfully")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(PID|nginx)'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n    root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2213")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6784")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2036")]),s._v(" ?        Ss   03:01   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -HUP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2213")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("当 nginx 接收到 HUP 信号，它会尝试先解析配置文件（如果指定配置文件，就使用指定的，否则使用默认的），成功的话，就应用新的配置文件（例如：重新打开日志文件或监听的套接 字）。之后，nginx 运行新的工作进程并从容关闭旧的工作进程。通知工作进程关闭监听套接字但是继续为当前连接的客户提供服务。所有客户端的服务完成后，旧的工作进程被关闭。 如果新的配置文件应用失败，nginx 将继续使用旧的配置进行工作。")]),s._v(" "),a("h2",{attrs:{id:"平滑升级到新的二进制代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#平滑升级到新的二进制代码"}},[s._v("#")]),s._v(" 平滑升级到新的二进制代码")]),s._v(" "),a("p",[s._v("你可以在不中断服务的情况下 - 新的请求也不会丢失，使用新的 nginx 可执行程序替换旧的（当升级新版本或添加/删除服务器模块时）。")]),s._v(" "),a("p",[s._v("首先，使用新的可执行程序替换旧的（最好做好备份），然后，发送 USR2 (kill -USR2 pid)信号给主进程。主进程将重命名它的 .pid 文件为 .oldbin (比如：/usr/local/nginx/logs/nginx.pid.oldbin)，然后执行新的可执行程序，依次启动新的主进程和新的工作进程：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  PID  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("    %CPU   VSZ WCHAN  COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1164")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33134")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33135")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1380")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33136")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1368")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1148")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36265")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36266")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36267")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在这时，两个 nginx 实例会同时运行，一起处理输入的请求。要逐步停止旧的实例，你必须发送 WINCH 信号给旧的主进程，然后，它的工作进程就将开始从容关闭：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  PID  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("    %CPU   VSZ WCHAN  COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1164")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33135")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1380")]),s._v(" kqread nginx: worker process is shutting down "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1148")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36265")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36266")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36267")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("一段时间后，旧的工作进程处理了所有已连接的请求后退出，就仅由新的工作进程来处理输入的请求了：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  PID  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("    %CPU   VSZ WCHAN  COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1164")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33126")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1148")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36265")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36266")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36267")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这时，因为旧的服务器还尚未关闭它监听的套接字，所以，通过下面的几步，你仍可以恢复旧的服务器：")]),s._v(" "),a("p",[s._v("发送 HUP 信号给旧的主进程 - 它将在不重载配置文件的情况下启动它的工作进程\n发送 QUIT 信号给新的主进程，要求其从容关闭其工作进程\n发送 TERM 信号给新的主进程，迫使其退出\n如果因为某些原因新的工作进程不能退出，向其发送 KILL 信号\n新的主进程退出后，旧的主进程会由移除 .oldbin 前缀，恢复为它的 .pid 文件，这样，一切就都恢复到升级之前了。")]),s._v(" "),a("p",[s._v("如果尝试升级成功，而你也希望保留新的服务器时，发送 QUIT 信号给旧的主进程使其退出而只留下新的服务器运行：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  PID  "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("    %CPU   VSZ WCHAN  COMMAND\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1148")]),s._v(" pause  nginx: master process /usr/local/nginx/sbin/nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36265")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36266")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36267")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36264")]),s._v(" nobody   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1364")]),s._v(" kqread nginx: worker process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);